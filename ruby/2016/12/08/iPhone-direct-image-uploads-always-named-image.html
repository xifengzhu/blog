<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    iPhone直接上传图片总是命名为image.jpg的解决方法 - 夕枫主&#39;s blog
    
  </title>

  <meta name="description" content="经常会遇到一种场景，那就是上传图片，如果是在移动设备上还可以调用到摄像头。">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="xifengzhu.github.com/ruby/2016/12/08/iPhone-direct-image-uploads-always-named-image.html">
  <link rel="alternate" type="application/rss+xml" title="夕枫主&#39;s blog" href="/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="/">夕枫主&#39;s blog</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fa fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/posts">Posts</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/about">About</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Page Header -->

<header class="masthead" style="background-image: url('/assets/images/bg-post.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>iPhone直接上传图片总是命名为image.jpg的解决方法</h1>
            
            <span class="meta">
              December 08, 2016 &middot; <span class="reading-time" title="Estimated read time">
  
   2 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p>经常会遇到一种场景，那就是上传图片，如果是在移动设备上还可以调用到摄像头。</p>

<h4 id="问题">问题</h4>
<p>但是在iphone上调用iphone摄像头生成图片的图片文件名都为<code class="language-plaintext highlighter-rouge">image.jp</code>,如果此时用户连续两次调用摄像头更新图片，那就会出现<strong>图片已经存在的问题</strong>。</p>

<blockquote>
  <p>It is correct that the iphone(ipad, etc, i’ll just call it iphone from now on) strips exif data. This is also not a bug on the iphone but actually a feature.
One of the main reasons android users don’t like the iphone and iphone users don’t like the androids, is because the iphone is very limited (in terms of freedom to change, alter, etc). You can not just run downloaded apps, have limited access to settings, etc.
This is because the apple strategy is to create a fail-safe product. “If you can not do strange things, strange things will not happen”.It tries to protect the user in every way imaginable. It also protects the user when uploading images. In the exif there may be data that can hurt the users privacy. Things like GPS coordinates, but even a timestamp can hurt a user (imagine you uploading a beach picture with a timestamp from a moment you reported in sick with the boss).
So basically it is a safety meassure to strip all exif data. Myself and a lot of other people do not agree with this strategy, but there is nothing we can do about it unfortunately.</p>
  <h4 id="解决方案">解决方案</h4>
  <p>首先，iphone摄像头照片（Exchange Image File）是不能为之命名的，所在这个只能通过其他的变通方式解决这个问题</p>
</blockquote>

<h5 id="方案1">方案1:</h5>
<p>将拍照所得的照片 转成 base64 再上传到服务端(比如使用： https://github.com/gokercebeci/canvasResize)</p>

<h5 id="方案2">方案2</h5>
<p>根据需求确定下图片是否能被覆盖
如果使用CarrierWave, 就会有如下方法</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">store_dir</span>
    <span class="s2">"uploads/</span><span class="si">#{</span><span class="n">model</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">to_s</span><span class="p">.</span><span class="nf">underscore</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">mounted_as</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">model</span><span class="p">.</span><span class="nf">id</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
</code></pre></div></div>
<p>我们可以看到，其实存储的路径中带有model的Id作为区分，如果用户是对同一对象进行覆盖那肯定是没有问题的。</p>

<p>如果如果需要留下用户的图片，不想覆盖，也可以通过</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">filename</span>
    <span class="s2">"something.jpg"</span> <span class="k">if</span> <span class="n">original_filename</span>
  <span class="k">end</span>
</code></pre></div></div>
<p>进行重命名文件（比如加上时间戳之类的），这样就不会有冲突啦</p>


        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/nginx/2016/08/19/nginx.html" data-toggle="tooltip" data-placement="top" title="nginx">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/linux/2017/03/10/Linux-logrotate-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2.html" data-toggle="tooltip" data-placement="top" title="Linux logrotate 日志分割">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          

        </div>

      </div>
    </div>
  </div>

<style>
    img {
        max-width: -webkit-fill-available;
    }
</style>

  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:xifengzhu520@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/xifengzhu">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/xifengzhu">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; xifengzhu 2024</p>
      </div>
    </div>
  </div>
</footer>


  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/scripts.js"></script>

<script src="/assets/scripts.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '');
</script>



</body>

</html>